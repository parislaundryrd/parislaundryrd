<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Paris Laundry RD</title>
    <link rel="icon" href="./img/Paris Laundry 1.png" type="image/png">
    <link rel="stylesheet" href="./css/styles_1.css">
    <script src="https://www.gstatic.com/firebasejs/9.16.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.16.0/firebase-firestore-compat.js"></script>
</head>

<body>
    <div class="container_background">
        <div class="logo_background">
            <img src="./img/Paris Laundry 1.png" alt="Logo">
        </div>
    </div>




    <div class="container_master">



        <div class="container_body">
            <div class="box_search-container">
                <div class="search-container">
                    <!-- <input type="text" id="searchInput" placeholder="Consulta tu ropa con tu ID..." /> -->
                    <input type="text" id="searchInput" placeholder="Introduce tu ID para consultar tu ropa..." />
                    <div class="cantidad-img"><img src="./img/icon/buscar3.png"></div>
                </div>
                <div id="message" style="color: red; display: none;"></div>
            </div>

            <!-- Contenido -->
            <div class="contenido">

                <div class="parrafo" style="display: inline-flex;flex-direction: column;align-items: center;">
                    <h2 style="text-align: center;">Horario de Atenci贸n</h2>

                    <div style="display: inline-flex;flex-direction: row;align-items: center;gap: 10px;">
                        <img src="./img/icon/reloj1.png" style="height: 75px;">
                        <p><strong> Lunes a Viernes:</strong> 8:00AM - 8:00PM<br>
                            <strong> S谩bados:</strong> 8:30AM - 7:00PM<br>
                            <strong> Domingos:</strong> No laborable
                        </p>
                    </div>
                </div>

                <div class="parrafo">
                    <h2 style="text-align: center;">驴C贸mo Funciona?</h2>
                    <p>Somos una lavander铆a tipo Laundry. Nos traes tu ropa sucia y te la entregamos limpia, doblada y
                        perfumada, 隆todo el mismo d铆a!</p>

                    <h3>Servicios:</h3>

                    <p>锔 Lavado<br>
                        锔 Secado<br>
                        锔 Doblado<br>
                        锔 Ropa en general<br>
                        锔 <strong>Especiales:</strong> S谩banas, toallas, colchas, manteles y cortinas</p>
                </div>


                <div class="parrafo">
                    <h2 style="text-align: center;">Productos Utilizados</h2>
                    <p>Т Detergente<br>
                        Т Suavizante<br>
                        Т Fundas perfumadas<br>
                        Т Perlas aromatizantes<br>
                        Т Blanqueador<br>
                        Т Desmanchante<br>
                        Т Tratamiento para moho y 贸xido</p>
                </div>

                <div class="parrafo" style="background: #e2e8ff;border-radius: 14px;">
                    <h2 style="text-align: center;">Preguntas Frecuentes</h2>
                    <p><strong>孤Tiempo de entrega?</strong><br>
                        Aproximadamente 2 - 3 horas, dependiendo del volumen de 贸rdenes en turno.</p>

                    <p><strong>孤Hasta qu茅 hora se reciben 贸rdenes para entrega el mismo d铆a?</strong><br>
                        Hasta las 5:00 PM.</p>

                    <p><strong>孤Puedo elegir solo lavar o solo secar?</strong><br>
                        S铆, puedes optar por:<br>
                        锔 Lavado y secado<br>
                        锔 Solo secado<br>
                        锔 Lavado y exprimido</p>

                    <p><strong>孤Las 贸rdenes se entregan dobladas y empacadas?</strong><br>
                        S铆, todas las 贸rdenes se entregan dobladas y empacadas.</p>

                    <p><strong>孤Puedo quedarme a dividir mi ropa?</strong><br>
                        S铆, si prefieres dividir tu ropa, puedes hacerlo antes del lavado.</p>

                    <p><strong>孤Puedo traer mi propio detergente?</strong><br>
                        S铆, en caso de alergias, puedes traer tu propio detergente. No obstante, contamos con productos
                        especializados para pieles sensibles.</p>
                </div>


                <div class="parrafo" style="padding: 0px 7px;">
                    <h2 style="text-align: center;">Vis铆tanos!</h2>
                    <p><strong>Estamos ubicados en:</strong> Santo Domingo Este, Sector Alma Rosa, Calle Club Activo
                        2030
                        #24, 2do nivel.</p>

                    <!-- Start Map -->
                    <iframe class="map-iframe"
                        src="https://maps.google.com/maps?q=18.4955583597753, -69.85320459280894&t=&z=15&ie=UTF8&iwloc=&output=embed"
                        allowfullscreen="" loading="lazy">
                    </iframe>
                    <!-- End Map -->
                </div>


            </div>
            <!-- Contenido FIN -->

            <div class="container_down">
                <p>Developed by J.P.</p>
            </div>

        </div>


    </div>


    <!-- Modal 煤nico para mostrar el estado -->
    <div id="statusModal" class="modal">
        <div class="modal-content">
            <div class="modal_preview_factura_tittle">
                <span class="close" id="closeStatusModal">&times;</span>
                <h2 id="modalTitle">Estado del Lavado</h2>
            </div>
            <div class="modal_preview_factura_body">

                <!-- Contenido para "Pago Pendiente" -->
                <div id="pendingInvoiceDetails" class="invoice-status" style="display: none;">


                    <div class="fechaYid">
                        <div>
                            <span>Fecha de la Factura:</span> <strong style="font-size: 19px;"
                                id="pendingDate"></strong>
                        </div>

                        <div>
                            <span>ID de la factura:</span><strong style="font-size: 37px;" id="pendingID"></strong>

                        </div>
                    </div>

                    <div class="imgContent">
                        <div>
                            <p style="font-size: 25px;font-weight: bold">Estamos pendiente a su pago</p>
                            <img src="./img/status/pagopendiente1.gif" alt="pago pendiente"
                                style="height: 56%;filter: contrast(1.5);">

                            <p>Cuando se confirme su pago podra ver el estado de su ropa en esta misma pantalla</p>
                        </div>
                    </div>

                </div>
                <!-- Contenido para "Pago Pendiente" FIN -->


                <!-- Contenido para "Pagado" -->
                <div id="paidInvoiceDetails" class="invoice-status" style="display: none; height: 100%;">


                    <div class="fechaYid">
                        <div>
                            <span>Fecha y hora de la Factura:</span> <strong style="font-size: 19px;"
                                id="paidDate"></strong>
                        </div>

                        <div>
                            <span>ID de la Factura:</span> <strong style="font-size: 37px;" id="paidID"></strong>
                        </div>
                    </div>

                    <div class="imgContent">
                        <div>
                            <p style="font-size: 25px;font-weight: bold;">Su ropa est谩 en proceso de lavado</p>
                            <img src="./img/status/lavadora0.gif" alt="Lavando" />
                            <p>Cuando su ropa est茅 lista le notificaremos en esta misma pantalla</p>
                        </div>
                    </div>

                </div>
                <!-- Contenido para "Pagado" FIN -->

                <!-- Contenido para "Pagado Listo" -->
                <div id="readyInvoiceDetails" class="invoice-status" style="display: none;">

                    <div class="fechaYid">
                        <div>
                            <span>Fecha de la Factura:</span> <strong style="font-size: 19px;" id="readyDate"></strong>
                        </div>

                        <div>
                            <span>ID de la Factura:</span> <strong style="font-size: 37px;" id="readyID"></strong>
                        </div>
                    </div>

                    <div class="imgContent">
                        <div>
                            <p style="font-size: 25px;font-weight: bold;">Su ropa est谩 lista para ser recogida
                            </p>
                            <img src="./img/status/check1.png" style="height: 24%; margin: 50px 0px;" alt="Lavando" />
                            <p>隆Gracias por preferirnos!</p>
                        </div>
                    </div>

                </div>
            </div>

            <div class="modal_preview_factura_down">
                <p>Developed by J.P.</p>
            </div>


        </div>
    </div>

    <script>
        // Configuraci贸n de Firebase
        const firebaseConfig = {
            apiKey: "AIzaSyDdG-CP2kO3v-zkkjD17Wj028QJvjp54qY",
            authDomain: "paris-laundry.firebaseapp.com",
            projectId: "paris-laundry",
            storageBucket: "paris-laundry.appspot.com",
            messagingSenderId: "1022712814457",
            appId: "1:1022712814457:web:7bddb47ed46bac22c32da8"
        };

        // Inicializar Firebase
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();

        const statusModal = document.getElementById("statusModal");
        const closeStatusModal = document.getElementById("closeStatusModal");
        const searchInput = document.getElementById("searchInput");
        const messageDiv = document.getElementById("message");

        let unsubscribe = null; // Para almacenar la funci贸n de desuscripci贸n del listener

        closeStatusModal.onclick = () => {
            statusModal.style.display = "none";
        };

        searchInput.addEventListener("keypress", async (event) => {
            if (event.key === "Enter") {
                const searchTerm = searchInput.value.trim().toLowerCase(); // Convertir a min煤sculas
                messageDiv.style.display = "none"; // Limpiar mensaje previo

                if (searchTerm) {
                    // Si ya hay un listener activo, desuscribirse
                    if (unsubscribe) {
                        unsubscribe();
                    }

                    const querySnapshot = await db.collection("facturas").where("id", "==", searchTerm).get();
                    if (!querySnapshot.empty) {
                        const doc = querySnapshot.docs[0];
                        const data = { id: doc.id, ...doc.data() };

                        // Actualizar la URL con el ID
                        window.location.hash = `id-${data.id}`;

                        // Mostrar el modal correspondiente seg煤n el estado
                        updateModal(data);

                        // Escuchar cambios en tiempo real
                        unsubscribe = db.collection("facturas").doc(doc.id).onSnapshot((docSnapshot) => {
                            const updatedData = { id: docSnapshot.id, ...docSnapshot.data() };
                            updateModal(updatedData);
                        });
                    } else {
                        messageDiv.textContent = "Factura no encontrada";
                        messageDiv.style.display = "block";
                    }
                } else {
                    messageDiv.textContent = "Por favor, ingrese un ID.";
                    messageDiv.style.display = "block";
                }
            }
        });

        // Funci贸n para actualizar el modal seg煤n el estado
        const updateModal = (data) => {
            // Ocultar el teclado
            searchInput.blur(); // Esto oculta el teclado en dispositivos m贸viles

            const options = {
                year: 'numeric',
                month: 'numeric',
                day: 'numeric',
                hour: 'numeric',
                minute: 'numeric',
                hour12: true // Formato de 12 horas
            };

            let fecha;
            // Verificar si el timestamp es un objeto de tipo Timestamp de Firebase
            if (data.timestamp instanceof firebase.firestore.Timestamp) {
                // Convertir a Date y ajustar a UTC-4
                const date = data.timestamp.toDate();
                const utcOffset = -4 * 60; // UTC-4 en minutos
                const localDate = new Date(date.getTime() + (utcOffset * 60 * 1000));
                fecha = localDate.toLocaleString('es-ES', options);
            } else {
                // Si el timestamp no es un objeto Timestamp, intentar convertirlo directamente
                const date = new Date(data.timestamp);
                const utcOffset = -4 * 60; // UTC-4 en minutos
                const localDate = new Date(date.getTime() + (utcOffset * 60 * 1000));
                fecha = localDate.toLocaleString('es-ES', options);
            }

            // Ocultar todos los detalles de la factura
            document.querySelectorAll('.invoice-status').forEach(div => {
                div.style.display = 'none';
            });

            switch (data.status) {
                case "pago pendiente":
                    document.getElementById("pendingID").textContent = data.id;
                    document.getElementById("pendingDate").textContent = fecha;
                    document.getElementById("pendingInvoiceDetails").style.display = "block";
                    break;
                case "pagado":
                    document.getElementById("paidID").textContent = data.id;
                    document.getElementById("paidDate").textContent = fecha;
                    document.getElementById("paidInvoiceDetails").style.display = "block";
                    break;
                case "pagado listo":
                    document.getElementById("readyID").textContent = data.id;
                    document.getElementById("readyDate").textContent = fecha;
                    document.getElementById("readyInvoiceDetails").style.display = "block";
                    break;
                default:
                    messageDiv.textContent = "Estado desconocido";
                    messageDiv.style.display = "block";
                    return; // Salir de la funci贸n si el estado es desconocido
            }

            statusModal.style.display = "block"; // Mostrar el modal
            messageDiv.style.display = "none"; // Ocultar mensaje de error
        };

        // Funci贸n para abrir el modal si hay un ID en la URL
        const openModalFromHash = async () => {
            const hash = window.location.hash;
            if (hash.startsWith("#id-")) {
                const id = hash.substring(4); // Obtener el ID del hash
                const querySnapshot = await db.collection("facturas").where("id", "==", id).get();
                if (!querySnapshot.empty) {
                    const doc = querySnapshot.docs[0];
                    const data = { id: doc.id, ...doc.data() };

                    // Mostrar el modal correspondiente seg煤n el estado
                    updateModal(data);

                    // Escuchar cambios en tiempo real
                    unsubscribe = db.collection("facturas").doc(doc.id).onSnapshot((docSnapshot) => {
                        const updatedData = { id: docSnapshot.id, ...docSnapshot.data() };
                        updateModal(updatedData);
                    });
                } else {
                    messageDiv.textContent = "Factura no encontrada";
                    messageDiv.style.display = "block";
                }
            }
        };

        // Llamar a la funci贸n al cargar la p谩gina
        window.onload = openModalFromHash;
    </script>

</body>

</html>
